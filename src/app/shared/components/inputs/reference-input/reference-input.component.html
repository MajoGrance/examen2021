<div class="text-left w-100 mb-1">
    <div class="label mb-1 pl-1" *ngIf="!noPadding">{{ label }}&nbsp;<span *ngIf="control?.errors?.required" style="color: red;">*</span></div>
    <div class="p-inputgroup w-100 p-calendar">
        <input #input type="text" pInputText [placeholder]="placeholder" [(ngModel)]="model" class="form-control"
        autocomplete="off" (focusout)="control?.markAllAsTouched(); onPaste()" (input)="change(input.value)"
        [class.is-invalid]="control?.invalid && control?.touched" 
        [disabled]="readonly"/>
        <button type="button" pButton pRipple [icon]="icon" class="search-button" (click)="openPasteWindow()"
            [disabled]="readonly"></button>
    </div>
    <div class="invalid-feedback pl-1 pb-0 pt-0" *ngIf="control?.errors?.required"
        [class.d-block]="errors.required && control?.invalid && control?.touched">{{errors.required}}</div>
    <div class="invalid-feedback pl-1 pb-0 pt-0" *ngIf="control?.errors?.maxLenght"
        [class.d-block]="errors.maxLenght && control?.invalid && control?.touched">{{errors.maxLenght}}</div>
    <div class="invalid-feedback pl-1 pb-0 pt-0" *ngIf="control?.errors?.pattern"
        [class.d-block]="errors.pattern && control?.invalid && control?.touched">{{errors.pattern}}</div>
    <div class="invalid-feedback-space" *ngIf="(!control?.invalid || !control?.touched) &&!noPadding"></div>
</div>

<p-dialog [header]="'Buscar ' + name" [(visible)]="display" [modal]="true" [style]="{width: '30rem', 'max-height': '80vh'}"
    [draggable]="false" [resizable]="false">
    <p-table #dt [value]="source" [rows]="10" [paginator]="true" [columns]="columns"
        [responsive]="true" sortMode="multiple" [rowHover]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
        styleClass="p-datatable-sm p-datatable-responsive p-datatable-gridlines p-datatable-striped"
        [showCurrentPageReport]="true" [autoLayout]="true" class="table">
        <ng-template pTemplate="caption">
            <div class="row">
                <div class="col-md-12 text-right pb-2">
                    <span class="p-input-icon-left w-100" [class.p-input-icon-right]="searchInput.value">
                        <i class="pi pi-search"></i>
                        <input #searchInput pInputText type="text" [(ngModel)]="filterValue"
                            (input)="dt.filterGlobal(getValue($event.target), 'contains')" 
                            placeholder="Buscar..." class="w-100"/>
                        <i class="pi pi-times clear-filter" *ngIf="searchInput.value"
                            (click)="clearSearchInput(dt)"></i>
                    </span>
                </div>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th [pSortableColumn]="col.field" *ngFor="let col of columns">
                    {{col.header}}<p-sortIcon [field]="col.field" pTooltip="CTRL + CLICK"></p-sortIcon>
                    <p-columnFilter [type]="col.filterType" [field]="col.field" display="menu" [showOperator]="false"></p-columnFilter>
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-row>
            <tr class="table-row" (click)="selectRow(row)">
                <td *ngFor="let col of columns">
                    <span class="d-flex justify-content-between w-100">
                        <span class="p-column-title">{{col.header}}</span>
                        <span *ngIf="col.type ==='text' || col.type === 'id'">
                            <span *ngIf="col.refField && col.refName">{{row[col.refName][col.refField]}}</span>
                            <span *ngIf="!col.refField || !col.refName">{{row[col.field]}}</span>
                        </span>
                        <span *ngIf="col.type ==='option'">
                            <span class="option" *ngIf="col.refField && col.refName">
                                {{col.labels?col.labels[row[col.refName][col.refField]]:''}}</span>
                            <span class="option" *ngIf="!col.refField || !col.refName">
                                {{col.labels?col.labels[row[col.field]]:''}}</span>
                        </span>
                        <span *ngIf="col.type ==='numeric'">
                            <span *ngIf="col.refField && col.refName">{{row[col.refName][col.refField] | currency: '': '': '0.0-6': 'es-AR'}}</span>
                            <span *ngIf="!col.refField || !col.refName">{{row[col.field] | currency: '': '': '0.0-6': 'es-AR' }}</span>
                        </span>
                        <span *ngIf="col.type ==='boolean'" [class.text-center]="innerWidth>=641" [class.w-100]="innerWidth>=641">
                            <span *ngIf="row[col.field] === true">
                                <mat-icon class="material-icons-outlined check-icon">check_circle</mat-icon>
                            </span>
                            <span *ngIf="row[col.field] !== true">
                                <mat-icon class="material-icons-outlined cancel-icon">cancel</mat-icon>
                            </span>
                        </span>
                        <span *ngIf="col.type ==='list'" class="text-right" [class.text-center]="innerWidth>=641" [class.w-100]="innerWidth>=641">
                            <div class="mr-1 mb-1" style="display: inline-flex;" *ngFor="let permiso of row[col.field]">
                                <p-tag [value]="permiso"></p-tag>
                            </div>
                        </span>
                        <span *ngIf="col.type ==='date'">
                            <span *ngIf="col.refField && col.refName">{{row[col.refName][col.refField] | date: 'dd/MM/yyyy'}}</span>
                            <span *ngIf="!col.refField || !col.refName">{{row[col.field] | date: 'dd/MM/yyyy'}}</span>
                        </span>
                    </span>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td [attr.colspan]="columns.length + 2" class="text-center">
                    <div class="container">
                        <br>
                        <img class="no-data-img mt-3 mb-3" src="./assets/images/empty-box.svg"><br>
                        No se encontraron datos.<br><br>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</p-dialog>